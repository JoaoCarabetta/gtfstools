<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Filtering GTFS feeds • gtfstools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Filtering GTFS feeds">
<meta property="og:description" content="gtfstools">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gtfstools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/gtfstools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/filtering.html">Filtering GTFS feeds</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ipeaGIT/gtfstools/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="filtering_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Filtering GTFS feeds</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ipeaGIT/gtfstools/blob/HEAD/vignettes/filtering.Rmd" class="external-link"><code>vignettes/filtering.Rmd</code></a></small>
      <div class="hidden name"><code>filtering.Rmd</code></div>

    </div>

    
    
<p>GTFS feeds are often used to describe very large and complex public transport networks. These large files can become quite cumbersome to use, manipulate and move around, and it’s not unfrequent that one wants to analyze a specific subset of the data.</p>
<p><strong>gtfstools</strong> includes a few functions to filter GTFS feeds, thus allowing for faster and more convenient data processing. This vignette will introduce you to these functions and will cover their usage in detail.</p>
<p>We will start by loading the packages required by this demonstration into the current <strong>R</strong> session:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ipeagit.github.io/gtfstools/" class="external-link">gtfstools</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></code></pre></div>
<p><strong>gtfstools</strong> includes the following filtering functions:</p>
<ul>
<li><code><a href="../reference/filter_by_trip_id.html">filter_by_trip_id()</a></code></li>
<li><code><a href="../reference/filter_by_route_id.html">filter_by_route_id()</a></code></li>
<li><code><a href="../reference/filter_by_shape_id.html">filter_by_shape_id()</a></code></li>
<li><code><a href="../reference/filter_by_stop_id.html">filter_by_stop_id()</a></code></li>
<li><code><a href="../reference/filter_by_route_type.html">filter_by_route_type()</a></code></li>
<li><code><a href="../reference/filter_by_service_id.html">filter_by_service_id()</a></code></li>
<li><code><a href="../reference/filter_by_weekday.html">filter_by_weekday()</a></code></li>
<li><code><a href="../reference/filter_by_time_of_day.html">filter_by_time_of_day()</a></code></li>
<li><code><a href="../reference/filter_by_sf.html">filter_by_sf()</a></code></li>
</ul>
<div class="section level2">
<h2 id="filtering-gtfs-by-trip_id-route_id-shape_id-stop_id-route_type-or-service_id">Filtering GTFS by <code>trip_id</code>, <code>route_id</code>, <code>shape_id</code>, <code>stop_id</code>, <code>route_type</code> or <code>service_id</code>:<a class="anchor" aria-label="anchor" href="#filtering-gtfs-by-trip_id-route_id-shape_id-stop_id-route_type-or-service_id"></a>
</h2>
<p>The first five work in a very similar fashion. You specify a vector of identifiers, and the function keeps (or drops, as we’ll see soon) all the entries that are in any way related to this id. Let’s see how that works using <code><a href="../reference/filter_by_trip_id.html">filter_by_trip_id()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/spo_gtfs.zip"</span>, package <span class="op">=</span> <span class="st">"gtfstools"</span><span class="op">)</span>
<span class="va">gtfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_gtfs.html">read_gtfs</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span>
<span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">gtfs</span><span class="op">)</span>
<span class="co">#&gt; 811304 bytes</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">gtfs</span><span class="op">$</span><span class="va">trips</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">trip_id</span>, <span class="va">trip_headsign</span>, <span class="va">shape_id</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;       trip_id trip_headsign shape_id</span>
<span class="co">#&gt; 1: CPTM L07-0       JUNDIAI    17846</span>
<span class="co">#&gt; 2: CPTM L07-1           LUZ    17847</span>
<span class="co">#&gt; 3: CPTM L08-0  AMADOR BUENO    17848</span>
<span class="co">#&gt; 4: CPTM L08-1 JULIO PRESTES    17849</span>
<span class="co">#&gt; 5: CPTM L09-0        GRAJAU    17850</span>
<span class="co">#&gt; 6: CPTM L09-1        OSASCO    17851</span>

<span class="co"># keeping trips CPTM L07-0 and CPTM L07-1</span>
<span class="va">smaller_gtfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_by_trip_id.html">filter_by_trip_id</a></span><span class="op">(</span><span class="va">gtfs</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CPTM L07-0"</span>, <span class="st">"CPTM L07-1"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">smaller_gtfs</span><span class="op">)</span>
<span class="co">#&gt; 71592 bytes</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">smaller_gtfs</span><span class="op">$</span><span class="va">trips</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">trip_id</span>, <span class="va">trip_headsign</span>, <span class="va">shape_id</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;       trip_id trip_headsign shape_id</span>
<span class="co">#&gt; 1: CPTM L07-0       JUNDIAI    17846</span>
<span class="co">#&gt; 2: CPTM L07-1           LUZ    17847</span>

<span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">smaller_gtfs</span><span class="op">$</span><span class="va">shapes</span><span class="op">$</span><span class="va">shape_id</span><span class="op">)</span>
<span class="co">#&gt; [1] "17846" "17847"</span></code></pre></div>
<p>We can see from the code snippet above that the function not only filters the <code>trips</code> table, but all other tables that contain a key that can be identified via its relation to <code>trip_id</code>. For example, since the trips <code>CPTM L07-0</code> and <code>CPTM L07-1</code> are described by the shapes <code>17846</code> and <code>17847</code>, respectively, these are the only shapes kept in <code>smaller_gtfs</code>.</p>
<p>The function also supports the opposite behaviour: instead of keeping the entries related to the specified identifiers, you can <em>drop</em> them. To do that, set the <code>keep</code> argument to <code>FALSE</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># dropping trips CPTM L07-0 and CPTM L07-1</span>
<span class="va">smaller_gtfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_by_trip_id.html">filter_by_trip_id</a></span><span class="op">(</span>
    <span class="va">gtfs</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CPTM L07-0"</span>, <span class="st">"CPTM L07-1"</span><span class="op">)</span>,
    keep <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span>
<span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">smaller_gtfs</span><span class="op">)</span>
<span class="co">#&gt; 762576 bytes</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">smaller_gtfs</span><span class="op">$</span><span class="va">trips</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">trip_id</span>, <span class="va">trip_headsign</span>, <span class="va">shape_id</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt;       trip_id       trip_headsign shape_id</span>
<span class="co">#&gt; 1: CPTM L08-0        AMADOR BUENO    17848</span>
<span class="co">#&gt; 2: CPTM L08-1       JULIO PRESTES    17849</span>
<span class="co">#&gt; 3: CPTM L09-0              GRAJAU    17850</span>
<span class="co">#&gt; 4: CPTM L09-1              OSASCO    17851</span>
<span class="co">#&gt; 5: CPTM L10-0 RIO GRANDE DA SERRA    17852</span>
<span class="co">#&gt; 6: CPTM L10-1                BRÁS    17853</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">smaller_gtfs</span><span class="op">$</span><span class="va">shapes</span><span class="op">$</span><span class="va">shape_id</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "17848" "17849" "17850" "17851" "17852" "17853"</span></code></pre></div>
<p>And the specified trips (and their respective shapes as well) are nowhere to be seen. Now note that, since we are keeping many more entries in the second case, the resulting GTFS object, though smaller than the original, is much larger than in the first case.</p>
<p>The same logic applies to other filtering functions that you can use to filter a GTFS feed by <code>trip_id</code>, <code>route_id</code>, <code>shape_id</code>, <code>stop_id</code>, <code>route_type</code> or <code>service_id</code>.</p>
</div>
<div class="section level2">
<h2 id="filtering-gtfs-by-day-of-the-week-or-period-of-the-day">Filtering GTFS by day of the week or period of the day:<a class="anchor" aria-label="anchor" href="#filtering-gtfs-by-day-of-the-week-or-period-of-the-day"></a>
</h2>
<p>Some times, though, you might want to analyze only service levels on a certain days of the week or different periods of the day.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># keeps entries related to services than run on Sunday AND Saturday</span>
<span class="va">smaller_gtfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_by_weekday.html">filter_by_weekday</a></span><span class="op">(</span><span class="va">gtfs</span>, 
                                  weekday <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sunday"</span>, <span class="st">"saturday"</span><span class="op">)</span>, 
                                  combine<span class="op">=</span><span class="st">"and"</span><span class="op">)</span>

<span class="va">smaller_gtfs</span><span class="op">$</span><span class="va">calendar</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"service_id"</span>, <span class="st">"sunday"</span>, <span class="st">"saturday"</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt;    service_id sunday saturday</span>
<span class="co">#&gt; 1:        USD      1        1</span>
<span class="co">#&gt; 2:        _SD      1        1</span>
<span class="co">#&gt; 3:        USD      1        1</span>
<span class="co">#&gt; 4:        _SD      1        1</span>
<span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">smaller_gtfs</span><span class="op">)</span>
<span class="co">#&gt; 762312 bytes</span>

<span class="co"># keeps entries related to services than run EITHER Sunday or Saturday</span>
<span class="va">smaller_gtfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_by_weekday.html">filter_by_weekday</a></span><span class="op">(</span><span class="va">gtfs</span>, 
                                  weekday <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sunday"</span>, <span class="st">"saturday"</span><span class="op">)</span>, 
                                  combine<span class="op">=</span><span class="st">"or"</span><span class="op">)</span>
<span class="va">smaller_gtfs</span><span class="op">$</span><span class="va">calendar</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"service_id"</span>, <span class="st">"sunday"</span>, <span class="st">"saturday"</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt;     service_id sunday saturday</span>
<span class="co">#&gt;  1:        USD      1        1</span>
<span class="co">#&gt;  2:        US_      0        1</span>
<span class="co">#&gt;  3:        _SD      1        1</span>
<span class="co">#&gt;  4:        __D      1        0</span>
<span class="co">#&gt;  5:        _S_      0        1</span>
<span class="co">#&gt;  6:        USD      1        1</span>
<span class="co">#&gt;  7:        US_      0        1</span>
<span class="co">#&gt;  8:        _SD      1        1</span>
<span class="co">#&gt;  9:        __D      1        0</span>
<span class="co">#&gt; 10:        _S_      0        1</span>
<span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">smaller_gtfs</span><span class="op">)</span>
<span class="co">#&gt; 762992 bytes</span></code></pre></div>
<p>Meanwhile, the <code><a href="../reference/filter_by_time_of_day.html">filter_by_time_of_day()</a></code> allows you to filter for example all services within a specified time period.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smaller_gtfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_by_time_of_day.html">filter_by_time_of_day</a></span><span class="op">(</span><span class="va">gtfs</span>, from <span class="op">=</span> <span class="st">"14:00:00"</span>, to <span class="op">=</span> <span class="st">"15:00:00"</span><span class="op">)</span>

<span class="co"># filter_by_time_of_day filters the frequencies table but doesn't filter the</span>
<span class="co"># stop_times table because they're just templates</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">smaller_gtfs</span><span class="op">$</span><span class="va">frequencies</span><span class="op">)</span>
<span class="co">#&gt;       trip_id start_time end_time headway_secs</span>
<span class="co">#&gt; 1: CPTM L07-0   14:00:00 14:59:00          480</span>
<span class="co">#&gt; 2: CPTM L07-1   14:00:00 14:59:00          480</span>
<span class="co">#&gt; 3: CPTM L08-0   14:00:00 14:59:00          480</span>
<span class="co">#&gt; 4: CPTM L08-1   14:00:00 14:59:00          480</span>
<span class="co">#&gt; 5: CPTM L09-0   14:00:00 14:59:00          420</span>
<span class="co">#&gt; 6: CPTM L09-1   14:00:00 14:59:00          420</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">smaller_gtfs</span><span class="op">$</span><span class="va">stop_times</span><span class="op">)</span>
<span class="co">#&gt;       trip_id arrival_time departure_time stop_id stop_sequence</span>
<span class="co">#&gt; 1: CPTM L07-0     04:00:00       04:00:00   18940             1</span>
<span class="co">#&gt; 2: CPTM L07-0     04:08:00       04:08:00   18920             2</span>
<span class="co">#&gt; 3: CPTM L07-0     04:16:00       04:16:00   18919             3</span>
<span class="co">#&gt; 4: CPTM L07-0     04:24:00       04:24:00   18917             4</span>
<span class="co">#&gt; 5: CPTM L07-0     04:32:00       04:32:00   18916             5</span>
<span class="co">#&gt; 6: CPTM L07-0     04:40:00       04:40:00   18965             6</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="filtering-gtfs-by-a-spatial-extent">Filtering GTFS by a spatial extent:<a class="anchor" aria-label="anchor" href="#filtering-gtfs-by-a-spatial-extent"></a>
</h2>
<p>The <code><a href="../reference/filter_by_sf.html">filter_by_sf()</a></code> function allows you to filter GTFS data inside or outside a given spatial extent. This functions takes a spatial <code>sf</code>/<code>sfc</code> object (or its bounding box) and keeps/drops the entries related to shapes and trips selected via a specified spatial operation. It may sound a bit complicated, but it’s fairly easy to understand when shown. Let’s create an auxiliary function to save us some typing:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plotter</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">gtfs</span>,
                    <span class="va">geom</span>,
                    <span class="va">spatial_operation</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="va"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_intersects</a></span>,
                    <span class="va">keep</span> <span class="op">=</span> <span class="cn">TRUE</span>,
                    <span class="va">do_filter</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span>

  <span class="kw">if</span> <span class="op">(</span><span class="va">do_filter</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">gtfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_by_sf.html">filter_by_sf</a></span><span class="op">(</span><span class="va">gtfs</span>, <span class="va">geom</span>, <span class="va">spatial_operation</span>, <span class="va">keep</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">shapes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convert_shapes_to_sf.html">convert_shapes_to_sf</a></span><span class="op">(</span><span class="va">gtfs</span><span class="op">)</span>
  <span class="va">trips</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_trip_geometry.html">get_trip_geometry</a></span><span class="op">(</span><span class="va">gtfs</span>, file <span class="op">=</span> <span class="st">"stop_times"</span><span class="op">)</span>
  <span class="va">geom</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="va">geom</span><span class="op">)</span>

  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">trips</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">shapes</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">geom</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>

<span class="op">}</span></code></pre></div>
<p>This function:</p>
<ul>
<li>Conditionally filters a GTFS object given a spatial object (called <code>geom</code>);</li>
<li>Generates shapes’ and trips’ geometries as described in their respective tables;</li>
<li>Generates a polygon from the bounding box;</li>
<li>Plots all the <code>sf</code> objects cited above to show the effect of each <code><a href="../reference/filter_by_sf.html">filter_by_sf()</a></code> argument in the final result.</li>
</ul>
<p>Also, please note that our <code>plotter()</code> function takes the same arguments of <code><a href="../reference/filter_by_sf.html">filter_by_sf()</a></code> (with the exception of <code>do_filter</code>, which is used to show the unfiltered data), as well as the same defaults.</p>
<p>Let’s say that we want to filter GTFS data using the bounding box of the shape <code>68962</code>. Here’s how the unfiltered data looks like, with the bounding box placed on top of it.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="fu"><a href="../reference/convert_shapes_to_sf.html">convert_shapes_to_sf</a></span><span class="op">(</span><span class="va">gtfs</span>, shape_id <span class="op">=</span> <span class="st">"68962"</span><span class="op">)</span><span class="op">)</span>

<span class="fu">plotter</span><span class="op">(</span><span class="va">gtfs</span>, <span class="va">bbox</span>, do_filter <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="filtering_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>By default <code><a href="../reference/filter_by_sf.html">filter_by_sf()</a></code> (and <code>plotter()</code>, consequently) keeps all the data related to the trips and shapes that intersect the given geometry. Here’s how it looks like:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plotter</span><span class="op">(</span><span class="va">gtfs</span>, <span class="va">bbox</span><span class="op">)</span></code></pre></div>
<p><img src="filtering_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Alternatively you can also <em>drop</em> such data:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plotter</span><span class="op">(</span><span class="va">gtfs</span>, <span class="va">bbox</span>, keep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="filtering_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>You can also control which spatial operation you want to use to filter the data. This is how you’d keep the data that is contained inside the given geometry:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plotter</span><span class="op">(</span><span class="va">gtfs</span>, <span class="va">bbox</span>, spatial_operation <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="va"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_contains</a></span><span class="op">)</span></code></pre></div>
<p><img src="filtering_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>And, simultaneously using <code>spatial_operation</code> and <code>keep</code>, this is how you’d drop the data contained inside the geometry:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plotter</span><span class="op">(</span><span class="va">gtfs</span>, <span class="va">bbox</span>, spatial_operation <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="va"><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_contains</a></span>, keep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="filtering_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>All filtering functions return a GTFS object readily available to be manipulated and analyzed using the rest of <strong>gtfstools</strong>’ toolkit. For more information on how to use other functions made available by the package, please see the <a href="gtfstools.html">introductory vignette</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Daniel Herszenhut, Rafael H. M. Pereira, Pedro R. Andrade, Joao Bazzo, Ipea - Institute for Applied Economic Research.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
