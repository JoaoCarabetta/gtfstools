<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Set trip average speed — set_trip_speed • gtfstools</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Set trip average speed — set_trip_speed" />
<meta property="og:description" content="Sets the average speed of each specified trip_id by changing the
arrival_time and departure_time columns in stop_times." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gtfstools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.9008</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/gtfstools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ipeaGIT/gtfstools/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Set trip average speed</h1>
    <small class="dont-index">Source: <a href='https://github.com/ipeaGIT/gtfstools/blob/master/R/set_trip_speed.R'><code>R/set_trip_speed.R</code></a></small>
    <div class="hidden name"><code>set_trip_speed.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Sets the average speed of each specified <code>trip_id</code> by changing the
<code>arrival_time</code> and <code>departure_time</code> columns in <code>stop_times</code>.</p>
    </div>

    <pre class="usage"><span class='fu'>set_trip_speed</span><span class='op'>(</span><span class='va'>gtfs</span>, <span class='va'>trip_id</span>, <span class='va'>speed</span>, unit <span class='op'>=</span> <span class='st'>"km/h"</span>, by_reference <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>gtfs</th>
      <td><p>A GTFS object as created by <code><a href='read_gtfs.html'>read_gtfs</a></code>.</p></td>
    </tr>
    <tr>
      <th>trip_id</th>
      <td><p>A string vector including the <code>trip_id</code>s to have their
average speed set.</p></td>
    </tr>
    <tr>
      <th>speed</th>
      <td><p>A numeric representing the speed to be set. Its length must
either equal 1, in which case the value is recycled for all
<code>trip_id</code>s, or equal <code>trip_id</code>'s length.</p></td>
    </tr>
    <tr>
      <th>unit</th>
      <td><p>A string representing the unit in which the speed is given. One
of <code>"km/h"</code> (the default) or <code>"m/s"</code>.</p></td>
    </tr>
    <tr>
      <th>by_reference</th>
      <td><p>Whether to update <code>stop_times</code>' <code>data.table</code> by
reference. Defaults to <code>FALSE</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>If <code>by_reference</code> is set to <code>FALSE</code>, returns a GTFS object
  with the time columns of its <code>stop_times</code> adjusted. Else, returns a
  GTFS object invisibly (note that in this case the original GTFS object is
  altered).</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    

<p>The average speed is calculated as the difference between the arrival time at
the last stop minus the departure time at the first top, over the trip's
length (as calculated via <code><a href='get_trip_geometry.html'>get_trip_geometry</a></code>, based on the
<code>shapes</code> file). The arrival and departure times at all other stops (i.e.
not the first neither the last) are set as <code>""</code>, which is written as
<code>NA</code> with <code><a href='write_gtfs.html'>write_gtfs</a></code>. Some transport routing software,
such as <a href='http://www.opentripplanner.org/'>OpenTripPlanner</a>, support
specifying stop times like so. In such cases, they estimate arrival/departure
times at the others stops based on the average speed as well. We plan to add
that feature to this function in the future.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='va'>data_path</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata/spo_gtfs.zip"</span>, package <span class='op'>=</span> <span class='st'>"gtfstools"</span><span class='op'>)</span>

<span class='va'>gtfs</span> <span class='op'>&lt;-</span> <span class='fu'><a href='read_gtfs.html'>read_gtfs</a></span><span class='op'>(</span><span class='va'>data_path</span><span class='op'>)</span>

<span class='co'># the examples below require the 'lwgeom' package to be installed</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ns-load.html'>requireNamespace</a></span><span class='op'>(</span><span class='st'>"lwgeom"</span>, quietly <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>

  <span class='va'>gtfs_new_speed</span> <span class='op'>&lt;-</span> <span class='fu'>set_trip_speed</span><span class='op'>(</span><span class='va'>gtfs</span>, trip_id <span class='op'>=</span> <span class='st'>"CPTM L07-0"</span>, <span class='fl'>50</span><span class='op'>)</span>
  <span class='va'>gtfs_new_speed</span><span class='op'>$</span><span class='va'>stop_times</span><span class='op'>[</span><span class='va'>trip_id</span> <span class='op'>==</span> <span class='st'>"CPTM L07-0"</span><span class='op'>]</span>

  <span class='co'># original gtfs remains unchanged</span>
  <span class='va'>gtfs</span><span class='op'>$</span><span class='va'>stop_times</span><span class='op'>[</span><span class='va'>trip_id</span> <span class='op'>==</span> <span class='st'>"CPTM L07-0"</span><span class='op'>]</span>

  <span class='co'># now do it by reference</span>
  <span class='fu'>set_trip_speed</span><span class='op'>(</span><span class='va'>gtfs</span>, trip_id <span class='op'>=</span> <span class='st'>"CPTM L07-0"</span>, <span class='fl'>50</span>, by_reference <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
  <span class='va'>gtfs</span><span class='op'>$</span><span class='va'>stop_times</span><span class='op'>[</span><span class='va'>trip_id</span> <span class='op'>==</span> <span class='st'>"CPTM L07-0"</span><span class='op'>]</span>

<span class='op'>}</span>
</div><div class='output co'>#&gt;        trip_id arrival_time departure_time stop_id stop_sequence
#&gt;  1: CPTM L07-0     04:00:00       04:00:00   18940             1
#&gt;  2: CPTM L07-0                               18920             2
#&gt;  3: CPTM L07-0                               18919             3
#&gt;  4: CPTM L07-0                               18917             4
#&gt;  5: CPTM L07-0                               18916             5
#&gt;  6: CPTM L07-0                               18965             6
#&gt;  7: CPTM L07-0                               18923             7
#&gt;  8: CPTM L07-0                               18922             8
#&gt;  9: CPTM L07-0                             4114459             9
#&gt; 10: CPTM L07-0                               18921            10
#&gt; 11: CPTM L07-0                               18924            11
#&gt; 12: CPTM L07-0                               18925            12
#&gt; 13: CPTM L07-0                               18926            13
#&gt; 14: CPTM L07-0                               18971            14
#&gt; 15: CPTM L07-0                               18972            15
#&gt; 16: CPTM L07-0                               18973            16
#&gt; 17: CPTM L07-0                               18974            17
#&gt; 18: CPTM L07-0     05:12:44       05:12:44   18975            18</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Daniel Herszenhut, Rafael H. M. Pereira, Pedro R. Andrade, Joao Bazzo, Ipea - Institute for Applied Economic Research.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


